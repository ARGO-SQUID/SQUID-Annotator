annotate = {

  init: function(){
    $('#close-annotation').click(function(){
      annotate.closeAnnotationView()
    })
  },

  closeAnnotationView: function(){
    $('#annotation-view-container').removeClass('active')
    $('#annotation-view-container #inner-annotation-container').html("")
  },

  launchForLocation: function(location){
    $('#annotation-view-container').addClass('active')
    var annotateHtml = Mustache.to_html($('#annotate-location-template').html(), location)
    $('#annotation-view-container #inner-annotation-container').html(annotateHtml)
    anno.destroy()
    anno.makeAnnotatable(document.getElementById('annotate-image'));
    annotate.loadAnnotations(location)
  },

  annotationViewMode: function(){
    return $('#annotation-view-container').hasClass('active')
  },

  loadAnnotations: function(location){
    $.get(apiHost + "/api/v1/locations/" + location.id + "/annotations", function( data ) {
      _.each(data, function(annotation){
        oneAnnotation = {
          src : annotation.image_url,
          locationId: annotation.location_id,
          text : annotation.text,
          category: annotation.category,
          shapes : [{
            type : annotation.shape,
            geometry : { x : annotation.x, y: annotation.y, width : annotation.width, height: annotation.height }
          }]
        }
        anno.addAnnotation(oneAnnotation)
      })
    })
  },

  updateAnnotation: function(annotation){
    alert('hit this update')
  },
  createAnnotation: function(annotation){
    $.ajax({
      type: "POST",
      url: apiHost + "/api/v1/annotations",
      data: {annotation: {location_id: annotation.locationId,
                          text: annotation.text,
                          image_url: annotation.src,
                          category: annotation.category,
                          height: annotation.shapes[0].geometry.height,
                          width: annotation.shapes[0].geometry.width,
                          x: annotation.shapes[0].geometry.x,
                          y: annotation.shapes[0].geometry.y,
                          shape: annotation.shapes[0].type}},
      success: function(data){
        alert('saved!')
      },
      error: function(data){
        alert("Sorry, we couldn't favorite this story for you right now. Please try again.")
      }
    });
  }

}
